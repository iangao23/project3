<html>
<head>
    <link rel="stylesheet" href="p3.css">
    <script src="https://www.cs.unm.edu/~angel/WebGL/7E/Common/initShaders.js" defer></script>
    <script src="https://www.cs.unm.edu/~angel/WebGL/7E/Common/MV.js" defer></script>
    <script src="models.js" defer></script>
    <script src="p3.js" defer></script>
</head>
<body>
    <div id="container">
        <div class="app">
            <div class="title">Satellite orbiting Mars</div>
            <div class="setting">
                <div class="control">
                    <ul>
                        <li>Camera settings</li>
                        <li><span class="red-font">X</span><span id="x_crd">=&nbsp;0</span></li>
                        <li><input type="range" id="xt" min="-1" max="1" step="0.01" value="0"></li>
                        <li><span class="green-font">Y</span><span id="y_crd">=&nbsp;0</span></li>
                        <li><input type="range" id="yt" min="-1" max="1" step="0.01" value="0"></li>
                        <li><span class="blue-font">Z</span><span id="z_crd">=&nbsp;0.5</span></li>
                        <li><input type="range" id="zt" min="-1" max="1" step="0.01" value="0.5"></li>
                        <li><span>FoV</span><span id="fovy">=&nbsp;45</span></li>
                        <li><input type="range" id="fov" min="10" max="100" step="1" value="45"></li>
                        <li>Light position</li>
                        <li><span class="red-font">X</span><span id="lx_crd">=&nbsp;1.0</span></li>
                        <li><input type="range" id="lxt" min="-1" max="1" step="0.01" value="1.0"></li>
                        <li><span class="green-font">Y</span><span id="ly_crd">=&nbsp;1.0</span></li>
                        <li><input type="range" id="lyt" min="-1" max="1" step="0.01" value="1.0"></li>
                        <li><span class="blue-font">Z</span><span id="lz_crd">=&nbsp;1.0</span></li>
                        <li><input type="range" id="lzt" min="-1" max="1" step="0.01" value="1.0"></li>
                        <li><button id="reset_cl">reset</button></li>
                    </ul>
                </div> <!-- end control -->
                <div class="rock">
                    <canvas id="webgl-canvas">
                        Oops, your browser doesn't support the HTML5 canvas!
                    </canvas>
                </div> <!-- end rock -->
                <div class="control">
                  <ul>
                        <li>Satellite settings</li>
                        <li><span>Orbit speed</span><span id="os_crd">=&nbsp;3</span></li>
                        <li><input type="range" id="os" min="0" max="10" step="0.1" value="3"></li>
                        <li><span>Orbit distance</span><span id="od_crd">=&nbsp;0.65</span></li>
                        <li><input type="range" id="od" min="0.5" max="1.5" step="0.05" value="0.65"></li>
                        <li><span>Orbit angle</span><span id="oa_crd">=&nbsp;45</span></li>
                        <li><input type="range" id="oa" min="0" max="180" step="1" value="45"></li>
                        <li><button id="reset_ss">reset</button></li>          
                    </ul> 
                </div> <!-- end control -->
            </div> <!-- end setting -->
        </div> <!-- end app -->
    </div> <!-- end containter -->
</body>  
<script id="vertex-shader" type="x-shader/x-vertex">

  // ----------------------------------------------
  // Complete the GLSL program
  // ----------------------------------------------
  
  attribute vec3 a_position;
  attribute vec3 a_normal;
  
  uniform mat4 u_model_matrix;
  uniform mat4 u_view_matrix;
  uniform mat4 u_projection_matrix;
  uniform mat3 u_normal_matrix;
  uniform vec3 u_light_position;
  
  varying vec3 v_normal;
  varying vec3 v_light_direction;
  varying vec3 v_view_direction;

  void main() {
    // Transform position
    vec4 world_position = u_model_matrix * vec4(a_position, 1.0);
    vec4 view_position = u_view_matrix * world_position;
    gl_Position = u_projection_matrix * view_position;
    
    // Transform normal
    v_normal = normalize(u_normal_matrix * a_normal);
    
    // Calculate light direction (from vertex to light)
    v_light_direction = normalize(u_light_position - world_position.xyz);
    
    // Calculate view direction (from vertex to camera)
    v_view_direction = normalize(-view_position.xyz);
  }

</script>

<script id="fragment-shader" type="x-shader/x-fragment">
 
  precision mediump float;
  
  // ----------------------------------------------
  // Variables that are provided to you.
  // ----------------------------------------------
  float shininess = 20.0;
  vec4 kd = vec4( 1.0, 1.0, 1.0, 1.0 ); // diffuse material property
  vec4 ka = vec4( 0.5, 0.5, 0.5, 1.0 ); // ambient material property
  // ----------------------------------------------

  // ----------------------------------------------
  // Complete the GLSL program
  // ----------------------------------------------
  
  uniform vec3 u_color;
  
  varying vec3 v_normal;
  varying vec3 v_light_direction;
  varying vec3 v_view_direction;
   
  void main() {
    // Normalize interpolated vectors
    vec3 normal = normalize(v_normal);
    vec3 light_dir = normalize(v_light_direction);
    vec3 view_dir = normalize(v_view_direction);
    
    // Calculate reflection vector
    vec3 reflect_dir = reflect(-light_dir, normal);
    
    // Ambient component
    vec3 ambient = ka.rgb * u_color;
    
    // Diffuse component
    float diff = max(dot(normal, light_dir), 0.0);
    vec3 diffuse = kd.rgb * diff * u_color;
    
    // Specular component
    float spec = pow(max(dot(view_dir, reflect_dir), 0.0), shininess);
    vec3 specular = vec3(1.0, 1.0, 1.0) * spec;
    
    // Combine all components
    vec3 final_color = ambient + diffuse + specular;
    
    gl_FragColor = vec4(final_color, 1.0);
  }

 </script>

</html>